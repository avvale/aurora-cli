<div
    *transloco="let t"
    class="w-full max-w-3xl"
>
    <!-- Form -->
    <form
        [formGroup]="fg"
        novalidate
        (ngSubmit)="onSubmit($event)"
    >
        <!-- Section -->
        <div class="w-full">
            <div class="text-xl">{{ t('settings.ChangeYourPassword') }}</div>
            <div class="text-secondary">
                {{ t('settings.ChangeYourPasswordDescription') }}
            </div>
        </div>
        <div class="mt-8 grid w-full gap-6 sm:grid-cols-4">
            <!-- Current password -->
            <div class="sm:col-span-4">
                <mat-form-field
                    class="w-full"
                    subscriptSizing="dynamic"
                >
                    <mat-label>{{ t('settings.CurrentPassword') }}</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        svgIcon="heroicons_solid:key"
                        matPrefix
                    ></mat-icon>
                    <input
                        [type]="showCurrentPassword.type"
                        matInput
                        formControlName="currentPassword"
                    />
                    @if (currentPasswordStatus() === 'PENDING') {
                        <mat-icon matSuffix>
                            <mat-spinner diameter="20"></mat-spinner>
                        </mat-icon>
                    } @else if (currentPasswordStatus() === 'VALID') {
                        <mat-icon matSuffix>check</mat-icon>
                    } @else {
                        <mat-icon
                            matSuffix
                            fontSet="material-symbols-outlined"
                        >
                            exclamation
                        </mat-icon>
                    }
                    <mat-pass-toggle-visibility
                        #showCurrentPassword
                        class="ml-2"
                        matSuffix
                    ></mat-pass-toggle-visibility>
                    <mat-error>
                        {{ formErrors['currentPassword'] | async }}
                    </mat-error>
                </mat-form-field>
            </div>
            <!-- New password -->
            <div class="sm:col-span-4">
                <mat-form-field
                    class="w-full"
                    [subscriptSizing]="'dynamic'"
                >
                    <mat-label>{{ t('settings.NewPassword') }}</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:key'"
                        matPrefix
                    ></mat-icon>
                    <input
                        #newPasswordInput
                        [type]="showNewPassword.type"
                        matInput
                        formControlName="newPassword"
                    />
                    <button
                        type="button"
                        [aria-label]="t('iam.CreatePassword')"
                        matSuffix
                        mat-icon-button
                        (click)="handleCreateNewPassword()"
                    >
                        <mat-icon>sync</mat-icon>
                    </button>
                    <mat-pass-toggle-visibility
                        #showNewPassword
                        class="ml-2"
                        matSuffix
                    ></mat-pass-toggle-visibility>
                </mat-form-field>
                <mat-error>{{ formErrors['newPassword'] | async }}</mat-error>
                <mat-password-strength
                    #passwordStrengthComponent
                    class="col-6 col-start-1"
                    [password]="newPasswordInput.value"
                    [enableLengthRule]="true"
                    [min]="8"
                    [max]="30"
                    [enableLowerCaseLetterRule]="true"
                    [enableUpperCaseLetterRule]="true"
                    [enableDigitRule]="true"
                    [enableSpecialCharRule]="true"
                ></mat-password-strength>
            </div>

            <!-- Repeat new password -->
            <div class="sm:col-span-4">
                <mat-form-field
                    class="w-full"
                    [subscriptSizing]="'dynamic'"
                >
                    <mat-label>{{ t('settings.RepeatNewPassword') }}</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:key'"
                        matPrefix
                    ></mat-icon>
                    <input
                        [formControlName]="'repeatNewPassword'"
                        [type]="showNewPassword.type"
                        matInput
                    />
                </mat-form-field>
                <mat-error>
                    {{ formErrors['repeatNewPassword'] | async }}
                </mat-error>
                <div class="text-hint mt-1 text-md">
                    {{ t('settings.MinimumPasswordComplexity') }}
                </div>
            </div>
        </div>

        <!-- Divider -->
        <div class="my-10 border-t"></div>

        <!-- Actions -->
        <div class="flex items-center justify-end">
            <button
                type="submit"
                class="ml-4"
                [disabled]="
                    fg.pristine ||
                    ('settings::security.detail.update'
                        | getActionStatus
                        | async)
                "
                mat-flat-button
                color="primary"
            >
                {{ t('Update') }}
            </button>
        </div>
    </form>
</div>
