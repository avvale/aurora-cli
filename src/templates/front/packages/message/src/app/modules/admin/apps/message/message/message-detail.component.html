<div
    *transloco="let t"
    class="absolute inset-0 flex w-full flex-col overflow-hidden"
>
    <!-- Header -->
    <div
        class="bg-card flex flex-0 flex-col border-b p-6 sm:flex-row sm:items-center sm:justify-between sm:px-10 sm:py-4 dark:bg-transparent"
    >
        <div class="min-w-0 flex-1">
            <au-breadcrumb [data]="breadcrumb"></au-breadcrumb>
            <au-title>
                <mat-icon
                    class="mr-2 icon-size-8"
                    fontSet="material-symbols-outlined"
                >
                    notification_multiple
                </mat-icon>
                {{ t('message.Message') }}
                <au-chip
                    class="ml-4"
                    [color]="status() | getColorStatusMessage"
                    size="small"
                >
                    {{ t('message.Statuses.' + status()) }}
                </au-chip>
            </au-title>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex flex-shrink-0 items-center sm:ml-4 sm:mt-0">
            @if (
                currentViewAction.id === 'message::message.detail.edit' &&
                managedObject()?.status !== messageMessageStatus.SENT
            ) {
                <button
                    type="submit"
                    class="ml-3"
                    [disabled]="
                        fg.pristine ||
                        ('message::message.detail.update'
                            | getActionStatus
                            | async)
                    "
                    mat-flat-button
                    form="messageMessageFormDetail"
                    color="accent"
                >
                    @if (
                        'message::message.detail.update'
                            | getActionStatus
                            | async
                    ) {
                        <mat-icon>
                            <mat-spinner diameter="20"></mat-spinner>
                        </mat-icon>
                    } @else {
                        <mat-icon
                            class="mr-2 icon-size-5"
                            svgIcon="mat_solid:edit"
                            color="accent"
                        ></mat-icon>
                    }
                    {{ t('Update') }}
                </button>

                @if (status() === messageMessageStatus.DRAFT) {
                    <button
                        class="ml-3"
                        mat-flat-button
                        color="accent"
                        (click)="
                            actionService.action({
                                id: 'message::message.detail.sendMessage',
                                isViewAction: false,
                                meta: {
                                    message: managedObject(),
                                },
                            })
                        "
                    >
                        <mat-icon
                            class="icon-size-5"
                            svgIcon="mat_outline:send"
                        ></mat-icon>
                        {{ t('Send') }}
                    </button>
                } @else {
                    <button
                        class="ml-3"
                        mat-flat-button
                        color="accent"
                        (click)="
                            actionService.action({
                                id: 'message::message.detail.draftMessage',
                                isViewAction: false,
                                meta: {
                                    message: managedObject(),
                                },
                            })
                        "
                    >
                        <mat-icon
                            class="icon-size-5"
                            svgIcon="mat_outline:drafts"
                        ></mat-icon>
                        {{ t('message.Draft') }}
                    </button>
                }
            }

            @if (currentViewAction?.id === 'message::message.detail.new') {
                <button
                    type="submit"
                    class="ml-3"
                    [disabled]="
                        fg.pristine ||
                        ('message::message.detail.create'
                            | getActionStatus
                            | async)
                    "
                    mat-flat-button
                    form="messageMessageFormDetail"
                    color="accent"
                >
                    @if (
                        'message::message.detail.create'
                            | getActionStatus
                            | async
                    ) {
                        <mat-icon>
                            <mat-spinner diameter="20"></mat-spinner>
                        </mat-icon>
                    } @else {
                        <mat-icon
                            class="mr-2 icon-size-5"
                            svgIcon="mat_solid:save"
                        ></mat-icon>
                    }
                    {{ t('Create') }}
                </button>
            }
        </div>
        <!-- / Actions -->
    </div>
    <!-- / Header -->

    <!-- Main -->
    <div
        class="flex-auto overflow-y-auto px-6 pt-6 sm:px-6 sm:pt-6"
        cdkScrollable
    >
        <div class="layout__container mb-6">
            <div
                class="col-12 grid w-full min-w-0 grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3"
            >
                <!-- Recipients -->
                <div
                    class="bg-card flex flex-auto flex-col overflow-hidden rounded-2xl p-6 shadow"
                >
                    <div class="flex items-start justify-between">
                        <div
                            class="truncate text-lg font-medium leading-6 tracking-tight"
                        >
                            {{ t('message.Recipients') }}
                        </div>
                    </div>
                    <div class="mt-2 flex flex-col items-center">
                        <div
                            class="text-4xl font-bold leading-none tracking-tight text-blue-500 sm:text-5xl"
                        >
                            {{ totalRecipients() }}
                        </div>
                        <div
                            class="text-base font-medium text-blue-600 dark:text-blue-500"
                        >
                            {{ t('message.Users') }}
                        </div>
                    </div>
                </div>
                <!-- Reads -->
                <div
                    class="bg-card flex flex-auto flex-col overflow-hidden rounded-2xl p-6 shadow"
                >
                    <div class="flex items-start justify-between">
                        <div
                            class="truncate text-lg font-medium leading-6 tracking-tight"
                        >
                            {{ t('message.Reads') }}
                        </div>
                    </div>
                    <div class="mt-2 flex flex-col items-center">
                        <div
                            class="text-4xl font-bold leading-none tracking-tight text-green-500 sm:text-5xl"
                        >
                            {{ managedObject()?.reads || 0 }}
                        </div>
                        <div
                            class="text-base font-medium text-green-600 dark:text-green-500"
                        >
                            {{ t('message.Messages') }}
                        </div>
                    </div>
                </div>
                <!-- PerRead -->
                <div
                    class="bg-card flex flex-auto flex-col overflow-hidden rounded-2xl p-6 shadow"
                >
                    <div class="flex items-start justify-between">
                        <div
                            class="truncate text-lg font-medium leading-6 tracking-tight"
                        >
                            {{ t('message.PerRead') }}
                        </div>
                    </div>
                    <div class="mt-2 flex flex-col items-center">
                        <div
                            class="text-4xl font-bold leading-none tracking-tight text-amber-500 sm:text-5xl"
                        >
                            {{ totalRecipients() - managedObject()?.reads }}
                        </div>
                        <div
                            class="text-base font-medium text-amber-600 dark:text-amber-500"
                        >
                            {{ t('message.Messages') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-card">
            <form
                id="messageMessageFormDetail"
                [formGroup]="fg"
                novalidate
                (ngSubmit)="onSubmit($event)"
            >
                <mat-tab-group>
                    <mat-tab [label]="t('message.Recipients')">
                        <div class="layout__container">
                            @if (showTenantsBelongsInput()) {
                                <mat-form-field
                                    appearance="outline"
                                    class="col-12"
                                >
                                    <mat-label>
                                        {{ t('message.TenantManagers') }}
                                    </mat-label>
                                    <mat-select
                                        formControlName="tenantIds"
                                        multiple
                                        auScrollEnd
                                        (scrollEnd)="
                                            tenantAsyncMatSelectSearch({
                                                asyncMatSelectSearchState:
                                                    tenantManagersAsyncMatSelectSearchState,
                                                isFromScrollEndEvent: true,
                                                noResultsFoundTranslation:
                                                    t('NoResultsFound'),
                                            })
                                        "
                                    >
                                        <mat-option>
                                            <ngx-mat-select-search
                                                [formControl]="
                                                    tenantManagersAsyncMatSelectSearchState.itemFilterCtrl
                                                "
                                                [placeholderLabel]="
                                                    t('message.FindTenant')
                                                "
                                                [noEntriesFoundLabel]="
                                                    t('NoResultsFound')
                                                "
                                            ></ngx-mat-select-search>
                                        </mat-option>
                                        @if (
                                            tenantManagersAsyncMatSelectSearchState.selectedItems()
                                                .size > 0
                                        ) {
                                            <mat-optgroup
                                                [label]="t('SelectedOptions')"
                                            >
                                                @for (
                                                    tenant of tenantManagersAsyncMatSelectSearchState
                                                        .selectedItems()
                                                        .values();
                                                    track tenant.id
                                                ) {
                                                    <mat-option
                                                        [value]="tenant.id"
                                                        [object]="tenant"
                                                        [selectedItems]="
                                                            tenantManagersAsyncMatSelectSearchState.selectedItems
                                                        "
                                                        auMatSelectAddSelectedDirective
                                                    >
                                                        {{ tenant.name
                                                        }}{{
                                                            tenant.parent
                                                                ? ' [' +
                                                                  tenant.parent
                                                                      ?.name +
                                                                  ']'
                                                                : ''
                                                        }}
                                                    </mat-option>
                                                }
                                            </mat-optgroup>
                                            <mat-divider></mat-divider>
                                        }
                                        @for (
                                            tenant of tenantManagersAsyncMatSelectSearchState
                                                .filteredItems()
                                                .values();
                                            track tenant.id
                                        ) {
                                            @if (
                                                !tenantManagersAsyncMatSelectSearchState
                                                    .selectedItems()
                                                    .has(tenant.id)
                                            ) {
                                                <mat-option
                                                    [value]="tenant.id"
                                                    [disabled]="
                                                        tenant.id === null
                                                    "
                                                    [object]="tenant"
                                                    [selectedItems]="
                                                        tenantManagersAsyncMatSelectSearchState.selectedItems
                                                    "
                                                    auMatSelectAddSelectedDirective
                                                >
                                                    {{ tenant.name
                                                    }}{{
                                                        tenant.parent
                                                            ? ' [' +
                                                              tenant.parent
                                                                  ?.name +
                                                              ']'
                                                            : ''
                                                    }}
                                                </mat-option>
                                            }
                                        }
                                    </mat-select>
                                    @if (
                                        tenantManagersAsyncMatSelectSearchState.isLoading()
                                    ) {
                                        <mat-icon matSuffix>
                                            <mat-spinner
                                                diameter="20"
                                            ></mat-spinner>
                                        </mat-icon>
                                    }
                                    <mat-error>
                                        {{ formErrors?.tenantIds | async }}
                                    </mat-error>
                                </mat-form-field>
                            }

                            <mat-form-field
                                appearance="outline"
                                class="col-12"
                            >
                                <mat-label>
                                    {{ t('message.TenantRecipients') }}
                                </mat-label>
                                <mat-select
                                    formControlName="tenantRecipientIds"
                                    multiple
                                    auScrollEnd
                                    (scrollEnd)="
                                        tenantAsyncMatSelectSearch({
                                            asyncMatSelectSearchState:
                                                tenantRecipientsAsyncMatSelectSearchState,
                                            isFromScrollEndEvent: true,
                                            noResultsFoundTranslation:
                                                t('NoResultsFound'),
                                        })
                                    "
                                >
                                    <mat-option>
                                        <ngx-mat-select-search
                                            [formControl]="
                                                tenantRecipientsAsyncMatSelectSearchState.itemFilterCtrl
                                            "
                                            [placeholderLabel]="
                                                t('message.FindTenant')
                                            "
                                            [noEntriesFoundLabel]="
                                                t('NoResultsFound')
                                            "
                                        ></ngx-mat-select-search>
                                    </mat-option>
                                    @if (
                                        tenantRecipientsAsyncMatSelectSearchState.selectedItems()
                                            .size > 0
                                    ) {
                                        <mat-optgroup
                                            [label]="t('SelectedOptions')"
                                        >
                                            @for (
                                                tenant of tenantRecipientsAsyncMatSelectSearchState
                                                    .selectedItems()
                                                    .values();
                                                track tenant.id
                                            ) {
                                                <mat-option
                                                    [value]="tenant.id"
                                                    [object]="tenant"
                                                    [selectedItems]="
                                                        tenantRecipientsAsyncMatSelectSearchState.selectedItems
                                                    "
                                                    auMatSelectAddSelectedDirective
                                                >
                                                    {{ tenant.name
                                                    }}{{
                                                        tenant.parent
                                                            ? ' [' +
                                                              tenant.parent
                                                                  ?.name +
                                                              ']'
                                                            : ''
                                                    }}
                                                </mat-option>
                                            }
                                        </mat-optgroup>
                                        <mat-divider></mat-divider>
                                    }
                                    @for (
                                        tenant of tenantRecipientsAsyncMatSelectSearchState
                                            .filteredItems()
                                            .values();
                                        track tenant.id
                                    ) {
                                        @if (
                                            !tenantRecipientsAsyncMatSelectSearchState
                                                .selectedItems()
                                                .has(tenant.id)
                                        ) {
                                            <mat-option
                                                [value]="tenant.id"
                                                [disabled]="tenant.id === null"
                                                [object]="tenant"
                                                [selectedItems]="
                                                    tenantRecipientsAsyncMatSelectSearchState.selectedItems
                                                "
                                                auMatSelectAddSelectedDirective
                                            >
                                                {{ tenant.name
                                                }}{{
                                                    tenant.parent
                                                        ? ' [' +
                                                          tenant.parent?.name +
                                                          ']'
                                                        : ''
                                                }}
                                            </mat-option>
                                        }
                                    }
                                </mat-select>
                                @if (
                                    tenantRecipientsAsyncMatSelectSearchState.isLoading()
                                ) {
                                    <mat-icon matSuffix>
                                        <mat-spinner
                                            diameter="20"
                                        ></mat-spinner>
                                    </mat-icon>
                                }
                                <mat-error>
                                    {{ formErrors?.tenantRecipientIds | async }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field
                                appearance="outline"
                                class="col-12"
                            >
                                <mat-label>
                                    {{ t('message.ScopeRecipients') }}
                                </mat-label>
                                <mat-select
                                    formControlName="scopeRecipients"
                                    multiple
                                >
                                    <mat-option>
                                        <ngx-mat-select-search
                                            [formControl]="
                                                scopeRecipientFilterCtrl
                                            "
                                            [placeholderLabel]="
                                                t('message.FindScope')
                                            "
                                            [noEntriesFoundLabel]="
                                                t('NoResultsFound')
                                            "
                                        ></ngx-mat-select-search>
                                    </mat-option>
                                    @for (
                                        scope of filteredScopeRecipients$
                                            | async;
                                        track scope
                                    ) {
                                        <mat-option [value]="scope.code">
                                            {{ scope.name }}
                                        </mat-option>
                                    }
                                </mat-select>
                                <mat-error>
                                    {{ formErrors?.scopeRecipients | async }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field
                                appearance="outline"
                                class="col-12"
                            >
                                <mat-label>
                                    {{ t('message.TagRecipients') }}
                                </mat-label>
                                <mat-select
                                    formControlName="tagRecipients"
                                    multiple
                                >
                                    <mat-option>
                                        <ngx-mat-select-search
                                            [formControl]="
                                                tagRecipientFilterCtrl
                                            "
                                            [placeholderLabel]="
                                                t('message.FindTag')
                                            "
                                            [noEntriesFoundLabel]="
                                                t('NoResultsFound')
                                            "
                                        ></ngx-mat-select-search>
                                    </mat-option>
                                    @for (
                                        tag of filteredTagRecipients$ | async;
                                        track tag.name
                                    ) {
                                        <mat-option [value]="tag.name">
                                            {{ tag.name }}
                                        </mat-option>
                                    }
                                </mat-select>
                                <mat-error>
                                    {{ formErrors?.tagRecipients | async }}
                                </mat-error>
                            </mat-form-field>

                            <!-- #region component to manage account recipients -->
                            <au-grid-select-multiple-elements
                                #messageAccountsGridSelectMultipleElements
                                class="col-12 mt-0"
                                [id]="messageAccountsGridId"
                                [label]="t('message.AccountRecipients')"
                                [gridId]="messageAccountsGridId"
                                [originColumnsConfig]="
                                    originMessageAccountsColumnsConfig
                                "
                                [columnsConfig]="
                                    messageAccountsColumnsConfig$ | async
                                "
                                [gridData]="messageAccountsGridData$ | async"
                                [gridState]="messageAccountsGridState"
                                [dialogColumnsConfig]="
                                    accountsDialogColumnsConfig$ | async
                                "
                                [dialogGridData]="
                                    accountsDialogGridData$ | async
                                "
                                [dialogGridId]="accountsDialogGridId"
                                [dialogOriginColumnsConfig]="
                                    accountsDialogOriginColumnsConfig
                                "
                                [selectedCheckboxRowModel]="
                                    selectedCheckboxRowModel
                                "
                                (dialogSelectedCheckboxRowModelChange)="
                                    handleAccountsDialogRowsSectionChange(
                                        $event
                                    )
                                "
                                (selectedCheckboxRowModelChange)="
                                    handleAccountsRowsSectionChange($event)
                                "
                            >
                                <au-grid-translations
                                    [for]="messageAccountsGridId"
                                    [actionsMenu]="{
                                        unlink: t('Unlink'),
                                        cancel: t('Cancel'),
                                        close: t('Close'),
                                    }"
                                >
                                    @for (
                                        columnConfig of originMessageAccountsColumnsConfig;
                                        track columnConfig.field
                                    ) {
                                        <au-grid-column-translation
                                            [field]="columnConfig.field"
                                        >
                                            {{
                                                t(
                                                    columnConfig.translation
                                                        ? columnConfig.translation
                                                        : columnConfig.field.toPascalCase()
                                                )
                                            }}
                                        </au-grid-column-translation>
                                    }
                                </au-grid-translations>
                                <au-grid-translations
                                    [for]="accountsDialogGridId"
                                >
                                    @for (
                                        columnConfig of accountsDialogColumnsConfig$
                                            | async;
                                        track columnConfig.field
                                    ) {
                                        <au-grid-column-translation
                                            [field]="columnConfig.field"
                                        >
                                            {{
                                                t(
                                                    columnConfig.translation
                                                        ? columnConfig.translation
                                                        : columnConfig.field.toPascalCase()
                                                )
                                            }}
                                        </au-grid-column-translation>
                                    }
                                </au-grid-translations>
                                <ng-template
                                    auGridSelectMultipleCustomHeaderTemplate
                                    position="left"
                                >
                                    @if (
                                        managedObject()?.status !==
                                        messageMessageStatus.SENT
                                    ) {
                                        <div
                                            class="flex items-center justify-start"
                                        >
                                            <button
                                                type="button"
                                                class="mr-2"
                                                mat-icon-button
                                                (click)="
                                                    handleOpenAccountsDialog()
                                                "
                                            >
                                                <mat-icon
                                                    svgIcon="mat_solid:add"
                                                ></mat-icon>
                                                <span
                                                    class="cdk-visually-hidden"
                                                >
                                                    Add new item
                                                </span>
                                            </button>
                                            <button
                                                [disabled]="
                                                    messageAccountsSelectedRows.length ===
                                                    0
                                                "
                                                mat-flat-button
                                                (click)="
                                                    handleRemoveMessageAccountsSelected()
                                                "
                                            >
                                                <mat-icon
                                                    class="mr-2"
                                                    svgIcon="mat_solid:link_off"
                                                ></mat-icon>
                                                {{ t('RemoveSelected') }}
                                            </button>
                                        </div>
                                    }
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCustomHeaderDialogTemplate
                                    position="left"
                                >
                                    <ng-container>
                                        <button
                                            [disabled]="
                                                accountsDialogSelectedRows.length ===
                                                0
                                            "
                                            mat-flat-button
                                            (click)="
                                                handleAddAccountsSelected()
                                            "
                                        >
                                            <mat-icon class="mr-2">
                                                add_link
                                            </mat-icon>
                                            {{ t('AddSelected') }}
                                        </button>
                                    </ng-container>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueDialogTemplate
                                    field="type"
                                    let-type
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    {{ t('AccountTypes.' + type) }}
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueTemplate
                                    field="tenants"
                                    let-tenants
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="
                                            tenants | map: 'name' | join
                                        "
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            tenants.length > 0
                                                ? tenants.length
                                                : ''
                                        }}"
                                    >
                                        tenancy
                                    </mat-icon>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueTemplate
                                    field="scopes"
                                    let-scopes
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="scopes | join"
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            scopes?.length > 0
                                                ? scopes.length
                                                : ''
                                        }}"
                                    >
                                        ads_click
                                    </mat-icon>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueTemplate
                                    field="tags"
                                    let-tags
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="tags | join"
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            tags?.length > 0 ? tags.length : ''
                                        }}"
                                    >
                                        tag
                                    </mat-icon>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueDialogTemplate
                                    field="tenants"
                                    let-tenants
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="
                                            tenants | map: 'name' | join
                                        "
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            tenants.length > 0
                                                ? tenants.length
                                                : ''
                                        }}"
                                    >
                                        tenancy
                                    </mat-icon>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueDialogTemplate
                                    field="scopes"
                                    let-scopes
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="scopes | join"
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            scopes?.length > 0
                                                ? scopes.length
                                                : ''
                                        }}"
                                    >
                                        ads_click
                                    </mat-icon>
                                </ng-template>
                                <ng-template
                                    auGridSelectMultipleCellValueDialogTemplate
                                    field="tags"
                                    let-tags
                                    let-columnConfig="columnConfig"
                                    let-row="row"
                                >
                                    <mat-icon
                                        aria-hidden="false"
                                        class="mr-2 cursor-pointer icon-size-6"
                                        [matTooltip]="tags | join"
                                        fontSet="material-symbols-outlined"
                                        matBadgeSize="small"
                                        matBadge="{{
                                            tags?.length > 0 ? tags.length : ''
                                        }}"
                                    >
                                        tag
                                    </mat-icon>
                                </ng-template>
                            </au-grid-select-multiple-elements>
                            <!-- #endregion component to manage account recipients -->
                        </div>
                    </mat-tab>

                    <mat-tab [label]="t('message.MessageWriting')">
                        <div class="layout__container">
                            <mat-form-field
                                appearance="outline"
                                class="au-datepicker col-4"
                            >
                                <mat-label>{{ t('message.SendAt') }}</mat-label>
                                <input
                                    [mtxDatetimepicker]="sendAtPicker"
                                    matInput
                                    formControlName="sendAt"
                                    auDatetimepickerSqlFormat
                                />
                                <mtx-datetimepicker-toggle
                                    [for]="sendAtPicker"
                                    matSuffix
                                ></mtx-datetimepicker-toggle>
                                <mtx-datetimepicker
                                    #sendAtPicker
                                    type="datetime"
                                    [multiYearSelector]="false"
                                    [twelvehour]="false"
                                    [timeInterval]="1"
                                    [touchUi]="false"
                                    mode="landscape"
                                    startView="month"
                                ></mtx-datetimepicker>
                                <mat-error>
                                    {{ formErrors?.sendAt | async }}
                                </mat-error>
                            </mat-form-field>
                            <div class="col-4 pt-5">
                                <mat-checkbox formControlName="isImportant">
                                    {{ t('message.IsImportant') }}
                                </mat-checkbox>
                            </div>
                            <mat-form-field
                                appearance="outline"
                                class="col-12"
                            >
                                <mat-label>
                                    {{ t('message.Subject') }}
                                </mat-label>
                                <input
                                    matInput
                                    formControlName="subject"
                                    maxlength="255"
                                    required
                                />
                                <mat-error>
                                    {{ formErrors?.subject | async }}
                                </mat-error>
                            </mat-form-field>
                            <div class="col-12">
                                <editor
                                    [init]="
                                        initEditor
                                            | setValueObject
                                                : 'placeholder'
                                                : t(
                                                      'message.StartHereToWriteYourMessage'
                                                  )
                                    "
                                    [licenseKey]="tinymceLicenseKey"
                                    [apiKey]="tinymceApiKey"
                                    formControlName="body"
                                ></editor>
                                <mat-error>
                                    {{ formErrors?.body | async }}
                                </mat-error>
                            </div>

                            @if (false) {
                                <mat-form-field
                                    appearance="outline"
                                    class="col-12"
                                >
                                    <mat-label>
                                        {{ t('message.Link') }}
                                    </mat-label>
                                    <input
                                        matInput
                                        formControlName="link"
                                        maxlength="2046"
                                    />
                                    <mat-error>
                                        {{ formErrors?.link | async }}
                                    </mat-error>
                                </mat-form-field>
                                <div class="col-4 pt-5">
                                    <mat-checkbox
                                        formControlName="isInternalLink"
                                    >
                                        {{ t('message.IsInternalLink') }}
                                    </mat-checkbox>
                                </div>
                                <mat-form-field
                                    appearance="outline"
                                    class="col-8"
                                >
                                    <mat-label>
                                        {{ t('message.Icon') }}
                                    </mat-label>
                                    <input
                                        matInput
                                        formControlName="icon"
                                        maxlength="64"
                                    />
                                    <mat-error>
                                        {{ formErrors?.icon | async }}
                                    </mat-error>
                                </mat-form-field>
                            }

                            @if (
                                managedObject()?.status !==
                                messageMessageStatus.SENT
                            ) {
                                <au-file-upload
                                    class="col-12"
                                    [isMultiple]="true"
                                    [dropLabel]="t('DropFilesHere')"
                                    [browseLabel]="t('BrowseLabel')"
                                    (onFileDrop)="
                                        actionService.action({
                                            id: 'message::message.detail.addAttachment',
                                            isViewAction: false,
                                            meta: {
                                                files: $event,
                                            },
                                        })
                                    "
                                ></au-file-upload>
                            }

                            <div class="col-12">
                                @for (
                                    attachment of this.fg.get(
                                        'attachmentsInputFile'
                                    ).value;
                                    track attachment.name;
                                    let i = $index
                                ) {
                                    <div
                                        class="mb-2 flex items-center justify-between rounded border p-4"
                                    >
                                        <p
                                            class="flex cursor-pointer items-center text-base"
                                            (click)="
                                                actionService.action({
                                                    id: 'message::message.detail.downloadAttachment',
                                                    isViewAction: false,
                                                    meta: {
                                                        attachment,
                                                    },
                                                })
                                            "
                                        >
                                            <mat-icon
                                                class="mr-2 icon-size-5"
                                                [svgIcon]="
                                                    'heroicons_solid:document'
                                                "
                                            ></mat-icon>
                                            {{ attachment.name }}
                                        </p>
                                        <p class="text-base opacity-60">
                                            {{ attachment.type }}
                                        </p>
                                        <p class="text-base opacity-60">
                                            {{
                                                (
                                                    attachment.size
                                                    | formatFileSize
                                                ).size
                                            }}{{
                                                (
                                                    attachment.size
                                                    | formatFileSize
                                                ).unit
                                            }}
                                        </p>
                                        <button
                                            class="ml-3"
                                            mat-icon-button
                                            (click)="
                                                actionService.action({
                                                    id: 'message::message.detail.removeAttachment',
                                                    isViewAction: false,
                                                    meta: {
                                                        attachment,
                                                        index: i,
                                                    },
                                                })
                                            "
                                        >
                                            <mat-icon
                                                class="icon-size-5"
                                                svgIcon="mat_solid:delete"
                                            ></mat-icon>
                                        </button>
                                    </div>
                                }

                                @for (
                                    attachment of managedObject()?.attachments;
                                    track attachment.id
                                ) {
                                    <div
                                        class="mb-2 flex items-center justify-between rounded border p-4"
                                    >
                                        <p
                                            class="flex cursor-pointer items-center text-base"
                                            (click)="
                                                actionService.action({
                                                    id: 'message::message.detail.downloadAttachment',
                                                    isViewAction: false,
                                                    meta: {
                                                        attachment,
                                                    },
                                                })
                                            "
                                        >
                                            <mat-icon
                                                class="mr-2 icon-size-5"
                                                [svgIcon]="
                                                    'heroicons_solid:document'
                                                "
                                            ></mat-icon>
                                            {{ attachment.originFilename }}
                                        </p>
                                        <p class="text-base opacity-60">
                                            {{ attachment.mimetype }}
                                        </p>
                                        <p class="text-base opacity-60">
                                            {{
                                                (
                                                    attachment.size
                                                    | formatFileSize
                                                ).size
                                            }}{{
                                                (
                                                    attachment.size
                                                    | formatFileSize
                                                ).unit
                                            }}
                                        </p>
                                        @if (
                                            managedObject()?.status !==
                                            messageMessageStatus.SENT
                                        ) {
                                            <button
                                                class="ml-3"
                                                mat-icon-button
                                                (click)="
                                                    actionService.action({
                                                        id: 'message::message.detail.removeAttachment',
                                                        isViewAction: false,
                                                        meta: {
                                                            attachment,
                                                            message:
                                                                managedObject(),
                                                        },
                                                    })
                                                "
                                            >
                                                <mat-icon
                                                    class="icon-size-5"
                                                    svgIcon="mat_solid:delete"
                                                ></mat-icon>
                                            </button>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </mat-tab>
                </mat-tab-group>
            </form>
        </div>
    </div>
    <!-- / Main -->
</div>
