<div
    *transloco="let t"
    class="absolute inset-0 flex w-full flex-col overflow-hidden"
>
    <!-- Header -->
    <div
        class="bg-card flex flex-0 flex-col border-b p-6 sm:flex-row sm:items-center sm:justify-between sm:px-10 sm:py-4 dark:bg-transparent"
    >
        <div class="min-w-0 flex-1">
            <au-breadcrumb [data]="breadcrumb"></au-breadcrumb>
            <au-title>
                <mat-icon
                    class="mr-2 icon-size-8"
                    fontSet="material-symbols-outlined"
                >
                    chat_paste_go
                </mat-icon>
                {{ t('queueManager.Queue') }}
            </au-title>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex flex-shrink-0 items-center sm:ml-4 sm:mt-0">
            @if (currentViewAction.id === 'queueManager::queue.detail.edit') {
                <button
                    type="submit"
                    class="ml-3"
                    [disabled]="
                        fg.pristine ||
                        ('queueManager::queue.detail.update'
                            | getSpinnerFlag
                            | async)
                    "
                    mat-flat-button
                    form="queueManagerQueueFormDetail"
                    color="accent"
                >
                    @if (
                        'queueManager::queue.detail.update'
                            | getSpinnerFlag
                            | async
                    ) {
                        <mat-icon>
                            <mat-spinner diameter="20"></mat-spinner>
                        </mat-icon>
                    } @else {
                        <mat-icon
                            class="mr-2 icon-size-5"
                            svgIcon="mat_solid:edit"
                        ></mat-icon>
                    }
                    {{ t('Update') }}
                </button>
            }

            @if (currentViewAction.id === 'queueManager::queue.detail.new') {
                <button
                    type="submit"
                    class="ml-3"
                    [disabled]="
                        fg.pristine ||
                        ('queueManager::queue.detail.create'
                            | getSpinnerFlag
                            | async)
                    "
                    mat-flat-button
                    form="queueManagerQueueFormDetail"
                    color="accent"
                >
                    @if (
                        'queueManager::queue.detail.create'
                            | getSpinnerFlag
                            | async
                    ) {
                        <mat-icon>
                            <mat-spinner diameter="20"></mat-spinner>
                        </mat-icon>
                    } @else {
                        <mat-icon
                            class="mr-2 icon-size-5"
                            svgIcon="mat_solid:save"
                        ></mat-icon>
                    }
                    {{ t('Create') }}
                </button>
            }
        </div>
        <!-- / Actions -->
    </div>
    <!-- / Header -->

    <!-- Main -->
    <div
        class="flex-auto overflow-y-auto px-6 pt-6 sm:px-10 sm:pt-10"
        cdkScrollable
    >
        <div class="form-card">
            <form
                id="queueManagerQueueFormDetail"
                [formGroup]="fg"
                novalidate
                (ngSubmit)="onSubmit($event)"
            >
                <div class="layout__container">
                    <mat-form-field
                        appearance="outline"
                        class="col-6"
                    >
                        <mat-label>{{ t('queueManager.Prefix') }}</mat-label>
                        <input
                            matInput
                            formControlName="prefix"
                            maxlength="63"
                            required
                        />
                        <mat-error>{{ formErrors?.prefix | async }}</mat-error>
                    </mat-form-field>
                    <mat-form-field
                        appearance="outline"
                        class="col-6"
                    >
                        <mat-label>{{ t('queueManager.Name') }}</mat-label>
                        <input
                            matInput
                            formControlName="name"
                            maxlength="63"
                            required
                        />
                        <mat-error>{{ formErrors?.name | async }}</mat-error>
                    </mat-form-field>

                    <!-- #region counters -->
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.WaitingJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'waiting',
                                },
                            })
                        "
                    >
                        <p class="text-7xl">
                            {{ managedObject.waitingJobs || 0 }}
                        </p>
                        @if (currentJobType === 'waiting') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.ActiveJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'active',
                                },
                            })
                        "
                    >
                        <p class="text-7xl">
                            {{ managedObject.activeJobs || 0 }}
                        </p>
                        @if (currentJobType === 'active') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.CompletedJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'completed',
                                },
                            })
                        "
                    >
                        <p class="text-7xl">
                            {{ managedObject.completedJobs || 0 }}
                        </p>
                        @if (currentJobType === 'completed') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.FailedJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'failed',
                                },
                            })
                        "
                    >
                        <p class="text-7xl text-red-600">
                            {{ managedObject.failedJobs || 0 }}
                        </p>
                        @if (currentJobType === 'failed') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.DelayedJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'delayed',
                                },
                            })
                        "
                    >
                        <p class="text-7xl">
                            {{ managedObject.delayedJobs || 0 }}
                        </p>
                        @if (currentJobType === 'delayed') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <au-mat-form-field-appearance
                        class="col-2 cursor-pointer"
                        [label]="t('queueManager.PausedJobs')"
                        (click)="
                            actionService.action({
                                id: 'queueManager::queue.detail.changeTypeJobsPagination',
                                isViewAction: false,
                                meta: {
                                    jobType: 'paused',
                                },
                            })
                        "
                    >
                        <p class="text-7xl">
                            {{ managedObject.pausedJobs || 0 }}
                        </p>
                        @if (currentJobType === 'paused') {
                            <mat-icon class="absolute right-2 top-2">
                                check
                            </mat-icon>
                        }
                    </au-mat-form-field-appearance>
                    <!-- #endregion counters -->

                    <!-- #region component to manage jobs -->
                    <au-grid-elements-manager
                        #jobsGridElementsManager
                        class="col-12 mt-2"
                        [columnsConfig]="jobsColumnsConfig$ | async"
                        [dialogTitle]="t('queueManager.Job')"
                        [gridData]="jobsGridData$ | async"
                        [gridState]="jobsGridState"
                        [id]="jobsGridId"
                        [label]="t('queueManager.Jobs')"
                        [dialogIcon]="'engineering'"
                        [originColumnsConfig]="jobsOriginColumnsConfig"
                        [hasSearch]="false"
                        [hasFilterButton]="false"
                    >
                        <!-- #region header grid buttons -->
                        <ng-template auGridCustomButtonsHeaderDialogTemplate>
                            <!-- no buttons -->
                        </ng-template>
                        <!-- #endregion header grid buttons -->

                        <ng-template
                            auGridFormElementDetailDialogTemplate
                            let-dialog
                        >
                            <form
                                id="jobDetailDialogForm"
                                [formGroup]="jobDialogFg"
                                novalidate
                                (ngSubmit)="
                                    handleSubmitBookForm($event, dialog)
                                "
                            >
                                <div class="layout__container">
                                    <mat-form-field
                                        appearance="outline"
                                        class="col-2"
                                    >
                                        <mat-label>{{ t('Id') }}</mat-label>
                                        <input
                                            matInput
                                            formControlName="id"
                                        />
                                        <mat-error>
                                            {{ formErrors?.id | async }}
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field
                                        appearance="outline"
                                        class="col-6"
                                    >
                                        <mat-label>{{ t('Name') }}</mat-label>
                                        <input
                                            matInput
                                            formControlName="name"
                                        />
                                        <mat-error>
                                            {{ formErrors?.name | async }}
                                        </mat-error>
                                    </mat-form-field>
                                    <mat-form-field
                                        appearance="outline"
                                        class="col-2"
                                    >
                                        <mat-label>
                                            {{ t('queueManager.Delay') }}
                                        </mat-label>
                                        <input
                                            matInput
                                            formControlName="delay"
                                        />
                                        <mat-error>
                                            {{ formErrors?.delay | async }}
                                        </mat-error>
                                    </mat-form-field>
                                    @if (managedJob?.failedReason) {
                                        <mat-form-field
                                            appearance="outline"
                                            class="col-12"
                                        >
                                            <mat-label>
                                                {{
                                                    t(
                                                        'queueManager.FailedReason'
                                                    )
                                                }}
                                            </mat-label>
                                            <input
                                                matInput
                                                formControlName="failedReason"
                                            />
                                            <mat-error>
                                                {{
                                                    formErrors?.failedReason
                                                        | async
                                                }}
                                            </mat-error>
                                        </mat-form-field>
                                    }
                                    @if (!(managedJob.opts | isObjectEmpty)) {
                                        <au-mat-form-field-appearance
                                            class="col-12"
                                            [label]="t('Options')"
                                        >
                                            <ngx-json-viewer
                                                class="m-4"
                                                [json]="managedJob.opts"
                                                [expanded]="false"
                                            ></ngx-json-viewer>
                                        </au-mat-form-field-appearance>
                                    }
                                    @if (!(managedJob.data | isObjectEmpty)) {
                                        <au-mat-form-field-appearance
                                            class="col-12"
                                            [label]="t('Data')"
                                        >
                                            <ngx-json-viewer
                                                class="m-4"
                                                [json]="managedJob.data"
                                                [expanded]="false"
                                            ></ngx-json-viewer>
                                        </au-mat-form-field-appearance>
                                    }
                                </div>
                            </form>
                        </ng-template>
                        <au-grid-translations
                            [for]="jobsGridId"
                            [actionsMenu]="{
                                cancel: t('Cancel'),
                                close: t('Close'),
                                remove: t('Remove'),
                            }"
                        >
                            @for (
                                columnConfig of originJobsColumnsConfig;
                                track columnConfig.field
                            ) {
                                <au-grid-column-translation
                                    [field]="columnConfig.field"
                                >
                                    {{
                                        t(
                                            columnConfig.translation
                                                ? columnConfig.translation
                                                : columnConfig.field.toPascalCase()
                                        )
                                    }}
                                </au-grid-column-translation>
                            }
                        </au-grid-translations>
                    </au-grid-elements-manager>
                    <!-- #endregion component to manage jobs -->
                </div>
            </form>
        </div>
    </div>
    <!-- / Main -->
</div>
